## 串口调试工具 Bug 记录文档

### 项目概述
- **项目名称**：基于 Qt6 的串口调试工具
- **开发语言**：C++
- **开发环境**：Windows 10 / Linux
- **开发工具**：Qt Creator
- **Qt 版本**：Qt6
- **目标功能**：串口打开关闭、数据发送与接收、波特率与串口参数设置

---

### Bug 详细记录

#### 1. Bug ID: 001
- **日期**: 2024-10-16
- **发现者**: ciyeer
- **Bug 描述**: 在串口发送数据时程序崩溃，未能捕获异常。
- **严重级别**: 高
- **复现步骤**:
  1. 打开串口
  2. 输入要发送的数据
  3. 点击发送按钮
- **预期行为**: 数据正常发送
- **实际行为**: 程序崩溃，出现空指针异常
- **问题分析**: 
  - 在发送数据时，程序未正确检查串口对象是否已经成功打开。当调用 `write()` 方法发送数据时，如果串口对象未正确初始化（例如串口未打开或对象指针为空），将导致程序崩溃。
  - 这种情况通常发生在用户打开串口失败后，依然尝试发送数据。
- **解决方案**: 
  - 在调用 `write()` 方法前，增加检查代码，确保串口对象已经打开 (`isOpen()` 返回 true)，同时增加空指针保护。
  - 如果串口未成功打开，禁止发送操作，并在 UI 中提示用户“请先打开串口”。
- **状态**: 已修复

---

#### 2. Bug ID: 002
- **日期**: 2024-10-17
- **发现者**: ciyeer
- **Bug 描述**: 数据位和停止位设置在UI中显示正常，但并未真正应用到串口通信。
- **严重级别**: 中
- **复现步骤**:
  1. 打开串口设置窗口
  2. 尝试设置数据位和停止位
  3. 打开串口并发送数据
- **预期行为**: 数据位和停止位的设置应被正确应用到串口，并影响发送/接收的数据格式。
- **实际行为**: 串口的通信参数没有按照设置生效，发送和接收的数据不符合设定的格式。
- **问题分析**: 
  - 界面设置参数后，程序没有正确调用 `QSerialPort` 的 `setDataBits()` 和 `setStopBits()` 等方法，导致设置没有应用到串口对象上。
  - 可能是因为信号和槽机制没有正确连接，导致用户在UI中的设置没有及时更新到串口对象中。
- **解决方案**: 
  - 检查参数设置界面与串口对象的关联，确保在用户修改设置后立即调用相应的 `QSerialPort` 方法。
  - 使用信号和槽机制确保参数设置的改变自动更新到串口配置中。
  - 另外，增加参数设置的回显功能，方便用户确认当前的串口配置。
- **状态**: 未修复

---

#### 3. Bug ID: 003
- **日期**: 2024-10-18
- **发现者**: ciyeer
- **Bug 描述**: 打开串口时提示“拒绝访问”错误。
- **严重级别**: 高
- **复现步骤**:
  1. 尝试打开串口设备
  2. 检查返回的错误消息
- **预期行为**: 串口正常打开，允许读取和写入数据。
- **实际行为**: 程序提示“拒绝访问”，无法打开串口。
- **问题分析**: 
  - 该错误可能由以下原因引起：
    1. 串口设备被其他程序占用，导致当前应用程序无法访问。
    2. 操作系统权限不足，当前用户没有足够的权限打开串口设备（特别是在 Linux 环境下，用户可能需要加入 `dialout` 用户组）。
    3. 串口设备文件的访问权限不正确（例如 `/dev/ttyS*` 或 `/dev/ttyUSB*` 文件）。
- **解决方案**: 
  - 检查系统中是否有其他程序正在使用同一个串口设备。
  - 在 Linux 系统下，确保当前用户属于 `dialout` 组，或者以 root 权限运行程序。
  - 使用 `chmod` 或 `chown` 命令调整串口设备文件的访问权限。
  - 在 Windows 系统下，检查是否有串口调试工具（如 Putty 等）占用了同一个串口。
- **状态**: 处理中

---

#### 4. Bug ID: 004
- **日期**: 2024-10-18
- **发现者**: ciyeer
- **Bug 描述**: 接收到的数据显示为乱码，无法正确解析十六进制或 ASCII 格式的数据。
- **严重级别**: 中
- **复现步骤**:
  1. 打开串口
  2. 发送一串已知格式的十六进制数据
  3. 检查接收显示区域的数据
- **预期行为**: 数据应按照设定的格式（如十六进制或 ASCII）正确显示。
- **实际行为**: 数据以乱码形式显示，无法正确解析。
- **问题分析**: 
  - 接收数据时没有进行正确的编码转换，可能是将二进制数据直接作为字符串进行显示，导致无法正确显示十六进制内容。
  - 另外，可能程序没有区分十六进制模式和 ASCII 模式，导致格式显示错误。
- **解决方案**: 
  - 增加数据格式转换功能，在接收到数据后根据用户选择的显示格式（十六进制或 ASCII）进行转换。
  - 使用 `QByteArray` 来接收原始数据，并根据选择的格式将其转换为 `QString` 或显示为十六进制。

- **状态**: 已修复

---

#### 5. Bug ID: 005

- **日期**: 2024-10-20
- **发现者**: ciyeer
- **Bug 描述**: 打开软件时，串口没有检测到串口号时，点击打开串口，程序奔溃
- **严重级别**: 高
- **复现步骤**:
    1. 打开串口工具，不要连接任何串口，串口下拉菜单中没有任何串口选项
    2. 点击打开串口
- **预期行为**: 串口工具提示 "未检测到串口，请重试"。
- **实际行为**: 串口工具程序崩溃。
- **问题分析**: 
- **解决方案**: 

- **状态**: 未修复

---

#### 6. Bug ID: 006

- **日期**: 2024-10-24
- **发现者**: ciyeer
- **Bug 描述**: 
    - 打开软件时，多次插拔串口会导致软件崩溃

- **严重级别**: 高
- **复现步骤**:
    1. 打开串口工具，多次插拔串口
    2. 点击打开串口
- **预期行为**: 串口工具提示 "未检测到串口，请重试"。
- **实际行为**: 串口工具程序崩溃。
- **问题分析**: 
- **解决方案**: 

- **状态**: 已修复

----

#### 7. Bug ID: 007

- **日期**: 2024-11-07
- **发现者**: ciyeer
- **Bug 描述**: 
    - 打开软件没有检测到串口，插入串口导致软件奔溃
- **严重级别**: 高
- **复现步骤**:
    1. 打开串口工具，插入串口，点击打开串口
- **预期行为**: 串口工具提示 "未检测到串口，请重试"。
- **实际行为**: 串口工具程序崩溃。
- **问题分析**: 
- **解决方案**: 

- **状态**: 已修复

---

#### 8. Bug ID: 008

- **日期**: 2024-11-08
- **发现者**: ciyeer
- **Bug 描述**: 
    - 如果串口在已经打开的情况下拔出串口，串口程序崩溃
- **严重级别**: 高
- **复现步骤**:
    1. 打开串口工具，插入串口，点击打开串口，拔出串口
- **预期行为**: 串口工具提示 "未检测到串口，请重试"。
- **实际行为**: 串口工具程序崩溃。
- **问题分析**: 程序崩溃的主要原因是当串口在打开状态下被拔出，`QSerialPort` 发出 `ResourceError` 时，后续对未关闭或失效资源的访问可能导致异常。
- **解决方案**: 
    - **串口错误的完整处理**： 确保在 `handleError` 函数中处理 `ResourceError` 时立即关闭串口资源，正确更新程序状态，并确保其他逻辑不会访问失效的 `QSerialPort` 对象。。
    - **信号断开**： 串口拔出时，需要将相关信号槽断开，防止后续访问失效的 `QSerialPort` 对象。
    - **UI 状态同步**： 更新 UI 元素的状态，避免用户误操作触发崩溃。
    - **线程安全和异常保护**： 包装串口操作（例如 `read`, `write`）时加入异常保护，以确保在失效的情况下不会导致崩溃。

- **状态**: 已修复

---

#### 9. Bug ID: 009

- **日期**: 2024-11-10
- **发现者**: ciyeer
- **Bug 描述**: 
    - 如果串口在已经打开的情况下拔出串口，打开串口的按钮不可用，但是发送,接收，清空等按钮并没有禁用
- **严重级别**: 中
- **复现步骤**:
    1. 打开串口工具，插入串口，点击打开串口，"打开串口"按钮变为"关闭串口"按钮，此时拔出串口。
- **预期行为**: 拔出串口时，"关闭按钮"变成"打开按钮"且是禁用状态，而且"发送数据"按钮，"清空发送区"按钮，"清空接收区"按钮都被禁用(灰度)。
- **实际行为**: 打开串口工具，插入串口，点击打开串口，"打开串口"按钮变为"关闭串口"按钮。拔出串口时，"关闭按钮"禁用，但是没有变成"打开按钮"，而且"发送数据"按钮，"清空发送区"按钮，"清空接收区"按钮都没有禁用(灰度)。
- **问题分析**: 
- **解决方案**: 

- **状态**: 
